<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title id="siteTitle">‎ </title>
<link id="siteIcon" rel="icon" href="https://www.google.com/favicon.ico">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600&family=Orbitron:wght@400;700&family=JetBrains+Mono:wght@400&family=Press+Start+2P&family=Cinzel:wght@400;700&family=VT323&display=swap" rel="stylesheet">
<style>
:root {
    --bg: #030303;
    --bg-gradient: linear-gradient(135deg, #030303, #1a0033);
    --accent: #00f2ff;
    --accent-secondary: #ff0055;
    --text: #ffffff;
    --panel-bg: rgba(5,5,5,0.92);
    --glow: 0 0 20px rgba(0, 242, 255, 0.3);
    --glow-strength: 0.3;
    --box-size: 130px;
    --grid-gap: 20px;
    --glass-blur: 12px;
    --radius: 16px;
    --font-main: 'Plus Jakarta Sans', sans-serif;
    --font-weight: 400;
    --letter-spacing: 0.5px;
    --line-height: 1.5;
    --ui-zoom: 1;
}

* { box-sizing: border-box; outline: none; user-select: none; scrollbar-width: thin; scrollbar-color: var(--accent) #111; }

body {
    margin: 0; height: 100vh; background: var(--bg-gradient);
    color: var(--text); font-family: var(--font-main);
    font-weight: var(--font-weight); letter-spacing: var(--letter-spacing);
    line-height: var(--line-height); overflow: hidden;
    transform: scale(var(--ui-zoom)); transform-origin: top left;
    transition: transform 0.4s, opacity 1.2s, filter 0.8s;
}

body.glitch-active { animation: glitch 4s infinite; }
@keyframes glitch {
    0%, 100% { transform: translate(0); }
    2%, 64%  { transform: translate(2px,0) skew(0deg); }
    4%, 60%  { transform: translate(-2px,0) skew(0deg); }
    62%      { transform: translate(0,2px) skew(5deg); }
}

body.compact {
    --box-size: 100px;
    --grid-gap: 12px;
    font-size: 0.92rem;
}

body.neon-outline { text-shadow: 0 0 5px var(--accent), 0 0 10px var(--accent); }
body.high-contrast { --text: #fff; --bg: #000; --accent: #ff0; --accent-secondary: #f80; --panel-bg: #222; }
body.reduced-motion * { transition: none !important; animation: none !important; }
body.large-text { font-size: 1.24rem; }
body.ui-faded { opacity: 0.16; }
body.glass-off { --glass-blur: 0px; }

/* Cursor */
body.custom-cursor * { cursor: none !important; }
#cursor {
    position: fixed; pointer-events: none; z-index: 99999;
    width: 28px; height: 28px; border: 2px solid var(--accent);
    border-radius: 50%; transform: translate(-50%, -50%);
    box-shadow: 0 0 16px var(--accent); mix-blend-mode: difference;
    transition: width 0.18s, height 0.18s; display: none;
}
#cursor.active { display: block; }

/* Trail dots */
.trail-dot {
    position: fixed; pointer-events: none; z-index: 99998;
    width: 8px; height: 8px; border-radius: 50%;
    background: var(--accent); opacity: 0; transition: opacity 0.6s;
}

/* Particles canvas */
#particleCanvas { position: fixed; inset: 0; z-index: 1; pointer-events: none; }

/* Rest of your original styles (tab-bar, views, grid, media, sidebar, etc.) would go here */
/* I'm skipping repeating the huge block for brevity — assume it's still present */

.btn { padding: 8px 16px; border-radius: 6px; cursor: pointer; text-transform: uppercase; font-weight: 700; }
.btn-accent { background: var(--accent); color: #000; border: none; }
.btn-red    { background: #c00; color: white; border: none; }

.fps-counter { font-family: 'VT323', monospace; font-size: 1.1rem; color: var(--accent); }
</style>
</head>
<body class="custom-cursor">

<div id="cursor"></div>
<canvas id="particleCanvas"></canvas>

<!-- Your original HTML structure here (tab bar, views, grid, media player, sidebar button, etc.) -->

<aside class="sidebar" id="sidebar">
    <div class="sb-header">
        <span class="sb-title">SYSTEM // CONFIG</span>
        <i class="fas fa-times" onclick="document.getElementById('sidebar').classList.remove('open')"></i>
    </div>

    <div class="sb-content">

        <details open>
            <summary>Appearance & Fonts</summary>
            <div class="control-group">
                <div class="row"><span>Primary Accent</span><input type="color" value="#00f2ff" onchange="app.setAccent(this.value)"></div>
                <div class="row"><span>Secondary Accent</span><input type="color" value="#ff0055" onchange="document.documentElement.style.setProperty('--accent-secondary', this.value)"></div>
                <div class="row"><span>Glow Strength</span><input type="range" min="0" max="1" step="0.05" value="0.3" oninput="document.documentElement.style.setProperty('--glow-strength', this.value)"></div>
                <div class="row"><span>Border Radius</span><input type="range" min="0" max="40" value="16" oninput="document.documentElement.style.setProperty('--radius', this.value+'px')"></div>
                <div class="row"><span>Glass Blur</span><input type="range" min="0" max="30" value="12" oninput="document.documentElement.style.setProperty('--glass-blur', this.value+'px')"></div>
                <div class="row"><span>Glassmorphism</span><input type="checkbox" checked onchange="document.body.classList.toggle('glass-off', !this.checked)"></div>
                <div class="row"><span>Neon Outline</span><input type="checkbox" checked onchange="document.body.classList.toggle('neon-outline', this.checked)"></div>
                <div class="row"><span>Glitch Effect</span><input type="checkbox" onchange="document.body.classList.toggle('glitch-active', this.checked)"></div>
                <div class="row"><span>Font Family</span>
                    <select onchange="app.setCSS('--font-main', this.value)">
                        <option value="'Plus Jakarta Sans', sans-serif">Jakarta</option>
                        <option value="'Orbitron', monospace">Orbitron</option>
                        <option value="'JetBrains Mono', monospace">Mono</option>
                        <option value="'VT323', monospace">VT323</option>
                    </select>
                </div>
                <div class="row"><span>Font Weight</span><input type="range" min="100" max="900" step="100" value="400" oninput="app.setCSS('--font-weight', this.value)"></div>
                <div class="row"><span>UI Zoom</span><input type="range" min="0.7" max="1.4" step="0.05" value="1" oninput="app.setCSS('--ui-zoom', this.value)"></div>
                <div class="row"><span>Compact Mode</span><input type="checkbox" onchange="document.body.classList.toggle('compact', this.checked)"></div>
                <button class="btn btn-red" onclick="app.resetVisuals()">Reset Visuals</button>
            </div>
        </details>

        <details>
            <summary>Particles</summary>
            <div class="control-group">
                <div class="row"><span>Type</span>
                    <select id="particle-mode" onchange="particles.setMode(this.value)">
                        <option value="matrix">Matrix Rain</option>
                        <option value="stars">Stars</option>
                        <option value="sparks">Sparks</option>
                        <option value="dust">Floating Dust</option>
                    </select>
                </div>
                <div class="row"><span>Count</span><input type="range" min="20" max="400" value="80" oninput="particles.count=this.value; particles.reset()"></div>
                <div class="row"><span>Speed</span><input type="range" min="0.2" max="4" step="0.1" value="1.2" oninput="particles.speed=this.value"></div>
            </div>
        </details>

        <!-- Keep your original other sections -->

    </div>
</aside>

<script>
// ────────────────────────────────────────────────
// Your original app code + extensions
// ────────────────────────────────────────────────

const app = {
    // ... your original methods (init, renderGrid, addLink, loadMedia, applyTheme, cloak, etc.) ...

    setAccent(c) {
        document.documentElement.style.setProperty('--accent', c);
        document.documentElement.style.setProperty('--glow', `0 0 20px ${c}88`);
        localStorage.setItem('accent', c);
    },

    resetVisuals() {
        document.documentElement.style.setProperty('--accent', '#00f2ff');
        document.documentElement.style.setProperty('--accent-secondary', '#ff0055');
        document.documentElement.style.setProperty('--glow-strength', '0.3');
        document.documentElement.style.setProperty('--radius', '16px');
        document.documentElement.style.setProperty('--glass-blur', '12px');
        document.documentElement.style.setProperty('--ui-zoom', '1');
        document.body.classList.remove('compact', 'neon-outline', 'glitch-active', 'high-contrast', 'large-text', 'glass-off');
        document.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = cb.defaultChecked);
        location.reload(); // simplest way to reset particles too
    },

    // ... rest of your original app object ...
};

// ────────────────────────────────────────────────
// Particles — extended with modes + mouse attraction + click burst
// ────────────────────────────────────────────────

const particles = {
    cvs: document.getElementById('particleCanvas'),
    ctx: null,
    items: [],
    count: 80,
    speed: 1.2,
    mode: 'matrix',
    mouse: { x: 0, y: 0, active: false },

    init() {
        this.cvs.width = window.innerWidth;
        this.cvs.height = window.innerHeight;
        this.ctx = this.cvs.getContext('2d');
        this.reset();
        this.loop();

        window.addEventListener('mousemove', e => {
            this.mouse.x = e.clientX;
            this.mouse.y = e.clientY;
            this.mouse.active = true;
        });

        window.addEventListener('click', e => this.burst(e.clientX, e.clientY));
    },

    reset() {
        this.items = [];
        for (let i = 0; i < this.count; i++) {
            let p = {
                x: Math.random() * this.cvs.width,
                y: Math.random() * this.cvs.height,
                size: Math.random() * 3 + 1,
                vx: (Math.random() - 0.5) * this.speed * 2,
                vy: (Math.random() - 0.5) * this.speed * 2,
                life: 1
            };
            if (this.mode === 'matrix') {
                p.char = String.fromCharCode(0x30A0 + Math.random()*96);
                p.vy = this.speed * 2 + Math.random() * 3;
                p.vx = 0;
            } else if (this.mode === 'stars') {
                p.size = Math.random() * 2 + 0.5;
                p.opacity = Math.random() * 0.7 + 0.3;
            } else if (this.mode === 'sparks') {
                p.size = Math.random() * 4 + 2;
                p.life = Math.random() * 0.8 + 0.2;
            } else if (this.mode === 'dust') {
                p.vx = (Math.random() - 0.5) * 0.6;
                p.vy = (Math.random() - 0.5) * 0.6;
                p.size = Math.random() * 1.5 + 0.5;
            }
            this.items.push(p);
        }
    },

    setMode(m) { this.mode = m; this.reset(); },

    burst(x, y) {
        for (let i = 0; i < 15; i++) {
            let angle = Math.random() * Math.PI * 2;
            let vel = Math.random() * 5 + 2;
            this.items.push({
                x, y,
                vx: Math.cos(angle) * vel,
                vy: Math.sin(angle) * vel,
                size: Math.random() * 4 + 2,
                life: 1,
                mode: 'sparks'
            });
        }
    },

    loop() {
        this.ctx.clearRect(0, 0, this.cvs.width, this.cvs.height);

        this.items.forEach((p, i) => {
            // mouse attraction
            if (this.mouse.active) {
                let dx = this.mouse.x - p.x;
                let dy = this.mouse.y - p.y;
                let dist = Math.sqrt(dx*dx + dy*dy);
                if (dist < 220 && dist > 0) {
                    let force = (220 - dist) / 220 * 0.8;
                    p.vx += dx / dist * force;
                    p.vy += dy / dist * force;
                }
            }

            p.x += p.vx;
            p.y += p.vy;

            // bounce
            if (p.x < 0 || p.x > this.cvs.width) p.vx *= -0.8;
            if (p.y < 0 || p.y > this.cvs.height) p.vy *= -0.8;

            // fade out bursts
            if (p.life !== undefined) {
                p.life -= 0.016;
                if (p.life <= 0) this.items.splice(i, 1);
            }

            let alpha = p.opacity || 0.7;
            if (p.mode === 'sparks' && p.life) alpha *= p.life;

            this.ctx.fillStyle = `rgba(0,242,255,${alpha})`;
            if (this.mode === 'matrix' || p.char) {
                this.ctx.font = '16px monospace';
                this.ctx.fillText(p.char || '█', p.x, p.y);
            } else {
                this.ctx.globalAlpha = alpha;
                this.ctx.beginPath();
                this.ctx.arc(p.x, p.y, p.size, 0, Math.PI*2);
                this.ctx.fill();
                this.ctx.globalAlpha = 1;
            }
        });

        requestAnimationFrame(() => this.loop());
    }
};

// ────────────────────────────────────────────────
// FPS counter
// ────────────────────────────────────────────────

let lastTime = performance.now();
let frameCount = 0;
let fpsDisplay = document.createElement('div');
fpsDisplay.className = 'fps-counter';
fpsDisplay.style.position = 'fixed';
fpsDisplay.style.top = '80px';
fpsDisplay.style.right = '20px';
fpsDisplay.style.zIndex = '100';
document.body.appendChild(fpsDisplay);

function updateFPS() {
    const now = performance.now();
    frameCount++;
    if (now - lastTime >= 2000) {
        const fps = Math.round(frameCount * 1000 / (now - lastTime));
        fpsDisplay.textContent = `FPS: ${fps}`;
        frameCount = 0;
        lastTime = now;
    }
    requestAnimationFrame(updateFPS);
}
updateFPS();

// ────────────────────────────────────────────────
// Cursor trail
// ────────────────────────────────────────────────

const trail = [];
for (let i = 0; i < 12; i++) {
    const dot = document.createElement('div');
    dot.className = 'trail-dot';
    document.body.appendChild(dot);
    trail.push(dot);
}

let trailIndex = 0;
document.addEventListener('mousemove', e => {
    const dot = trail[trailIndex];
    dot.style.left = e.clientX + 'px';
    dot.style.top = e.clientY + 'px';
    dot.style.opacity = '0.6';
    setTimeout(() => { dot.style.opacity = '0'; }, 400);
    trailIndex = (trailIndex + 1) % trail.length;
});

// Start particles
particles.init();

// Your original window.onload / onresize / other listeners here
</script>
</body>
</html>
